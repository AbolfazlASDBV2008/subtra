<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مترجم زیرنویس انیمه</title>
    
    <link rel="icon" type="image/jpeg" href="image-logo.jpg">
    <link rel="apple-touch-icon" href="image-logo.jpg">
    
    <meta name="theme-color" content="#3b82f6">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    
    <style>
        /* اعمال فونت وزیرمتن به کل صفحه */
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        input[type="file"] { display: none; }
        .file-upload-label { cursor: pointer; transition: all 0.3s ease; }
        #dropZone { border-style: dashed; transition: all 0.3s ease; }
        #dropZone.drag-over { background-color: #374151; border-color: #60a5fa; }
        .progress-bar-inner { transition: width 0.4s ease; }
        
        details summary { list-style: none; cursor: pointer; }
        details summary::-webkit-details-marker { display: none; }
        details summary::before { content: '◀'; display: inline-block; transition: transform 0.2s; margin-left: 0.5rem; }
        details[open] summary::before { transform: rotate(-90deg); }
        
        /* استایل برای رنج اسلایدر پیشرفته */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
            height: 6px;
            border-radius: 5px;
            cursor: pointer;
            /* گرادینت پیش‌فرض - توسط JS آپدیت می‌شود */
            background-image: linear-gradient(to right, #3b82f6 0%, #3b82f6 0%, #374151 0%, #374151 100%);
            background-repeat: no-repeat;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #93c5fd; /* blue-300 */
            cursor: pointer;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
            margin-top: -5px; /* تراز عمودی */
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: transparent; 
            border-radius: 5px;
        }
        input[type=range]:focus {
            outline: none; 
        }
        
        /* تولتیپ / مدال راهنما */
        .help-tooltip {
            display: none;
            position: absolute;
            z-index: 50;
            background-color: #374151; /* gray-700 */
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            padding: 1rem;
            width: 300px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            color: #e5e7eb;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        .help-tooltip.show {
            display: block;
        }

        .safety-settings-content {
            margin-top: 1rem;
            padding: 1rem 1.5rem;
            border: 1px solid #4b5563; /* gray-600 */
            border-radius: 0.5rem;
            background-color: #1f2937; /* gray-800 */
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .proxy-setting-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1rem;
            padding: 0.5rem;
            border: 1px dashed #4b5563; /* gray-600 */
            border-radius: 0.5rem;
        }

        .status-message {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: bold;
            text-align: center;
        }
        .status-complete { background-color: #166534; border: 1px solid #22c55e; color: #dcfce7; } /* green */
        .status-incomplete { background-color: #854d0e; border: 1px solid #f59e0b; color: #fefce8; } /* amber */
        .status-aborted { background-color: #991b1b; border: 1px solid #ef4444; color: #fee2e2; } /* red */

        #liveOutput {
            background-color: #111827; /* gray-900 */
            border: 1px solid #4b5563; /* gray-600 */
            border-radius: 0.5rem;
            padding: 1rem;
            height: 200px; /* ارتفاع ثابت */
            max-height: 40vh; /* حداکثر ارتفاع */
            overflow-y: auto; /* اسکرول عمودی */
            white-space: pre-wrap; /* شکستن خطوط */
            word-break: break-word; /* شکستن کلمات */
            overflow-wrap: anywhere; /* جلوگیری از بیرون زدگی متن طولانی */
            font-size: 0.9rem; /* کمی کوچکتر */
            line-height: 1.7;
            color: #d1d5db; /* gray-300 */
            margin-top: 1rem;
        }
        
        /* جلوگیری از بیرون زدگی متن در لاگ و خطاها */
        #statusLog, #errorMessageContainer, .break-words {
            overflow-wrap: anywhere;
            word-break: break-word;
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-gray-900 text-white p-4 md:p-8 min-h-screen">

    <div class="max-w-5xl mx-auto">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                مترجم زیرنویس انیمه
            </h1>
            <p class="text-gray-400 mt-2">
                فایل‌های VTT, SRT, یا ASS خود را به فارسی روان ترجمه کنید و با فرمت ASS تحویل بگیرید.
            </p>
        </header>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">تنظیمات اصلی</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <div class="mb-4 relative">
                        <div class="flex items-center gap-2 mb-2">
                            <label for="apiKey" class="text-sm font-medium text-gray-300">
                                کلید API گوگل (Gemini)
                            </label>
                            <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="apiKeyHelp">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                        <div class="relative">
                            <input type="password" id="apiKey" class="w-full p-2.5 pl-10 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500 font-mono text-sm" placeholder="کلید API خود را اینجا وارد کنید...">
                            <div class="absolute left-0 top-0 h-full px-3 flex items-center pointer-events-none">
                                <!-- قفل قرمز/سبز -->
                                <svg id="apiKeyLockIcon" class="w-5 h-5 text-red-500 transition-colors duration-300" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">کلید API باید با "AIza" شروع شود.</p>
                        
                        <!-- تولتیپ راهنما API Key -->
                        <div id="apiKeyHelp" class="help-tooltip top-8 right-0 z-50">
                            <p class="font-bold mb-1 text-blue-300">کلید API گوگل</p>
                            <p>این کلید شخصی شما برای ارتباط با سرورهای هوش مصنوعی گوگل است. برای دریافت آن به سایت <a href="https://aistudio.google.com/" target="_blank" class="text-blue-400 hover:underline">Google AI Studio</a> مراجعه کنید. این کلید در مرورگر شما ذخیره می‌شود و به جایی ارسال نمی‌گردد.</p>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="mb-4 relative">
                        <div class="flex items-center gap-2 mb-2">
                            <label for="modelSelect" class="text-sm font-medium text-gray-300">انتخاب مدل هوش مصنوعی</label>
                            <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="modelHelp">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                        <select id="modelSelect" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500">
                            <option value="gemini-3-pro-preview">Gemini 3 Pro (در طرح رایگان فعال نیست)</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro (قدرتمند و پایدار)</option>
                            <option value="gemini-2.5-flash-preview-09-2025">Gemini 2.5 Flash (سریع‌ترین)</option>
                            <option value="gemma-2-27b-it">Gemma 2 27B (Open Model)</option>
                        </select>
                        
                         <!-- تولتیپ راهنما Model -->
                         <div id="modelHelp" class="help-tooltip top-8 right-0 z-50">
                            <p class="font-bold mb-1 text-blue-300">مدل هوش مصنوعی</p>
                            <p>موتوری که ترجمه را انجام می‌دهد. <br><b>2.5 Pro:</b> تعادل عالی بین کیفیت و سرعت.<br><b>Flash:</b> سرعت بسیار بالا، مناسب برای فایل‌های حجیم.<br><b>3 Pro:</b> هوشمندترین مدل (ممکن است در حالت رایگان محدود باشد).</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- بخش تنظیمات پیشرفته -->
            <details class="bg-gray-750 border border-gray-700 rounded-lg p-4 mb-4 group">
                <summary class="font-bold text-lg text-blue-400 cursor-pointer flex items-center gap-2 select-none">
                    <span>⚙️ تنظیمات پیشرفته</span>
                </summary>
                
                <div class="mt-6 space-y-6 border-t border-gray-700 pt-4">
                    
                    <!-- کارت مدل و پارامترها -->
                    <div class="bg-gray-800/50 p-5 rounded-xl border border-gray-600/50 shadow-inner">
                        <h3 class="text-gray-200 font-bold mb-4 text-center text-lg">پارامترهای مدل هوش مصنوعی</h3>
                        
                        <div class="grid grid-cols-1 gap-8">
                            <!-- اسلایدر خلاقیت -->
                            <div class="relative">
                                <div class="flex justify-between mb-2 items-center">
                                    <div class="flex items-center gap-2">
                                        <label for="creativityRange" class="text-sm font-medium text-gray-300">
                                            دما (Temperature)
                                        </label>
                                        <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="tempHelp">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                                        </button>
                                    </div>
                                    <span id="creativityValue" class="text-blue-400 font-mono font-bold text-lg">0.2</span>
                                </div>
                                <input type="range" id="creativityRange" min="0" max="2" step="0.1" value="0.2" class="w-full" style="direction: ltr;">
                                
                                <!-- تولتیپ راهنما Temperature -->
                                <div id="tempHelp" class="help-tooltip bottom-12 right-0 md:right-auto md:left-0">
                                    <p class="font-bold mb-1 text-blue-300">Temperature (دما)</p>
                                    <p>میزان خلاقیت یا تصادفی بودن متن خروجی را تعیین می‌کند. مقادیر پایین‌تر (نزدیک به ۰) باعث تولید متنی قابل پیش‌بینی‌تر و متمرکزتر می‌شود، در حالی که مقادیر بالاتر (نزدیک به ۱ یا ۲) متنی متنوع‌تر و خلاقانه‌تر ایجاد می‌کند.<br>مقدار پیش‌فرض: 0.2</p>
                                </div>
                            </div>

                            <!-- اسلایدر Top-P -->
                            <div class="relative">
                                <div class="flex justify-between mb-2 items-center">
                                    <div class="flex items-center gap-2">
                                        <label for="topPRange" class="text-sm font-medium text-gray-300">
                                            Top-P
                                        </label>
                                        <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="topPHelp">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                                        </button>
                                    </div>
                                    <span id="topPValue" class="text-blue-400 font-mono font-bold text-lg">0.9</span>
                                </div>
                                <input type="range" id="topPRange" min="0" max="1" step="0.01" value="0.9" class="w-full" style="direction: ltr;">
                                
                                <!-- تولتیپ راهنما Top-P -->
                                <div id="topPHelp" class="help-tooltip bottom-12 right-0 md:right-auto md:left-0">
                                    <p class="font-bold mb-1 text-blue-300">Top-P (هسته نمونه‌برداری)</p>
                                    <p>یک روش نمونه‌برداری است که در آن مدل، مجموعه‌ای از محتمل‌ترین کلمات را که مجموع احتمال آن‌ها به عدد TopP می‌رسد، در نظر می‌گیرد. برای مثال، مقدار 0.9 باعث می‌شود فقط کلماتی که در 90% بالای توزیع احتمال قرار دارند، انتخاب شوند.<br>مقدار پیش‌فرض: 0.9</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ردیف دوم: FPS و پراکسی و لحن -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <!-- انتخاب لحن -->
                         <div class="relative">
                            <div class="flex items-center gap-2 mb-2">
                                <label for="toneSelect" class="text-sm font-medium text-gray-300">لحن ترجمه</label>
                                <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="toneHelp">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                                </button>
                            </div>
                            <select id="toneSelect" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500">
                                <option value="informal">محاوره‌ای / دوستانه (مناسب انیمه)</option>
                                <option value="formal">رسمی / کتابی</option>
                            </select>
                            
                            <!-- تولتیپ راهنما Tone -->
                            <div id="toneHelp" class="help-tooltip bottom-12 right-0 md:right-auto md:left-0">
                                <p class="font-bold mb-1 text-blue-300">لحن ترجمه</p>
                                <p>تعیین می‌کند هوش مصنوعی با چه سبکی ترجمه کند.<br><b>محاوره‌ای:</b> مناسب فیلم و انیمه (زبان شکسته‌نویسی).<br><b>رسمی:</b> مناسب مستند یا متون جدی (زبان معیار).</p>
                            </div>
                        </div>

                        <div class="relative">
                            <div class="flex items-center gap-2 mb-2">
                                <label for="fpsInput" class="text-sm font-medium text-gray-300">
                                    نرخ فریم (FPS)
                                </label>
                                <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="fpsHelp">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                                </button>
                            </div>
                            <input type="number" id="fpsInput" step="0.001" value="23.976" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500" style="direction: ltr; text-align: left;">
                            
                            <!-- تولتیپ راهنما FPS -->
                            <div id="fpsHelp" class="help-tooltip bottom-12 right-0 md:right-auto md:left-0">
                                <p class="font-bold mb-1 text-blue-300">نرخ فریم (FPS)</p>
                                <p>این عدد برای هماهنگی دقیق زمان‌بندی زیرنویس با ویدیو حیاتی است. اکثر انیمه‌ها 23.976 هستند. اگر زیرنویس شما هماهنگ نیست، این عدد را تغییر دهید (مثلاً به 24 یا 25).</p>
                            </div>
                        </div>
                    </div>

                     <div class="flex items-center relative">
                        <div class="proxy-setting-container w-full flex items-center">
                            <input type="checkbox" id="proxy-toggle" class="w-5 h-5 cursor-pointer">
                            <label for="proxy-toggle" class="font-medium text-gray-300 cursor-pointer select-none mr-2">
                                استفاده از پراکسی (دور زدن تحریم)
                            </label>
                            
                            <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn mr-auto ml-2" data-target="proxyHelp">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                        
                         <!-- تولتیپ راهنما Proxy -->
                         <div id="proxyHelp" class="help-tooltip bottom-14 left-0 z-50">
                            <p class="font-bold mb-1 text-blue-300">پراکسی (Proxy)</p>
                            <p>به دلیل تحریم‌های گوگل، دسترسی مستقیم از ایران ممکن نیست. با فعال کردن این گزینه، درخواست‌ها از طریق یک سرور واسط (Worker) ارسال می‌شوند تا مشکل دسترسی حل شود.</p>
                        </div>
                    </div>

                    <!-- تنظیمات ایمنی -->
                    <div>
                        <details class="safety-settings-details" role="region">
                            <summary class="font-medium text-gray-300 bg-gray-900 p-3 rounded-lg border border-gray-700 hover:bg-gray-800 transition-colors" aria-expanded="false" aria-controls="safety-settings-content">
                                تنظیمات ایمنی (Safety Filters)
                            </summary>
                            <div class="safety-settings-content mt-2" id="safety-settings-content">
                                <p class="text-xs text-gray-400">غیرفعال کردن فیلترها برای جلوگیری از سانسور محتوا.</p>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-white transition-colors">
                                    <input type="checkbox" id="safety-harassment-toggle" class="w-4 h-4 text-red-500 focus:ring-red-500">
                                    آزار و اذیت (Harassment)
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-white transition-colors">
                                    <input type="checkbox" id="safety-hate-speech-toggle" class="w-4 h-4 text-red-500 focus:ring-red-500">
                                    سخنان نفرت‌پراکن (Hate Speech)
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-white transition-colors">
                                    <input type="checkbox" id="safety-sexually-explicit-toggle" class="w-4 h-4 text-red-500 focus:ring-red-500">
                                    محتوای جنسی (Sexually Explicit)
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-white transition-colors">
                                    <input type="checkbox" id="safety-dangerous-content-toggle" class="w-4 h-4 text-red-500 focus:ring-red-500">
                                    محتوای خطرناک (Dangerous)
                                </label>
                            </div>
                        </details>
                    </div>

                    <!-- مدیریت پرامپت -->
                    <div class="relative">
                        <div class="flex items-center gap-2 mb-2">
                            <label class="text-sm font-medium text-gray-300">پرامپت سیستم (System Prompt)</label>
                            <button class="text-gray-500 hover:text-gray-300 focus:outline-none help-btn" data-target="promptHelp">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 111.731.999A.999.999 0 0010 10a1 1 0 110 2 1 1 0 010-2.204 3.004 3.004 0 10-1.37-5.83A2.99 2.99 0 0010 4zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                        
                        <!-- کنترل‌های مدیریت پرامپت -->
                        <div class="flex gap-2 mb-2 items-center">
                            <select id="promptSelector" class="flex-1 p-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:ring-blue-500 focus:border-blue-500">
                                <!-- گزینه‌ها توسط JS پر می‌شوند -->
                            </select>
                            <button id="addPromptBtn" class="p-2 bg-green-600 hover:bg-green-700 rounded-lg text-white transition-colors" title="افزودن پرامپت سفارشی">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="deletePromptBtn" class="p-2 bg-red-600 hover:bg-red-700 rounded-lg text-white transition-colors hidden" title="حذف این پرامپت">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <textarea id="systemPrompt" rows="6" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500 text-sm" style="text-align: right; direction: rtl;"></textarea>
                        <p id="promptReadOnlyMsg" class="text-xs text-yellow-500 mt-1 hidden">این پرامپت سیستمی ثابت است و قابل ویرایش نیست. برای تغییر، یک پرامپت سفارشی ایجاد کنید.</p>
                        
                         <!-- تولتیپ راهنما Prompt -->
                         <div id="promptHelp" class="help-tooltip bottom-full right-0 mb-2 z-50">
                            <p class="font-bold mb-1 text-blue-300">پرامپت سیستم</p>
                            <p>دستورالعمل اصلی که رفتار هوش مصنوعی را تعیین می‌کند. پرامپت پیش‌فرض برای ترجمه انیمه بهینه شده است. شما می‌توانید پرامپت‌های سفارشی خود را بسازید تا سبک ترجمه را به دلخواه خود تغییر دهید.</p>
                        </div>
                    </div>

                </div>
            </details>
            
            <div class="flex items-center gap-4 mt-4">
                <button id="resetSettings" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-sm font-semibold transition duration-300 shadow-md">
                    بازگردانی به پیش‌فرض
                </button>
                <span id="settingsReset" class="text-amber-400 hidden">تنظیمات به پیش‌فرض بازگردانی شد!</span>
            </div>
            </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">۱. انتخاب فایل‌ها</h2>
            <div id="dropZone" class="border-2 border-gray-600 rounded-lg p-10 text-center text-gray-400">
                <p class="mb-4">فایل‌های زیرنویس خود را اینجا بکشید و رها کنید</p>
                <p class="mb-4 text-sm">(فرمت‌های .vtt, .srt, .ass)</p>
                <label for="fileInput" class="file-upload-label px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium">
                    یا برای انتخاب فایل کلیک کنید
                </label>
                <input type="file" id="fileInput" multiple accept=".vtt,.srt,.ass">
            </div>
            <div id="fileList" class="mt-6 space-y-3">
                </div>
            <button id="clearFileList" class="mt-4 w-full md:w-auto px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-xs font-medium transition duration-300 disabled:opacity-50" style="display: none;">
                پاک کردن لیست فایل‌ها
            </button>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">۲. شروع عملیات</h2>
            
            <div id="outputFormatSelector" class="mt-6" style="display: none;">
                <label class="block mb-2 text-sm font-medium text-gray-300">فرمت فایل خروجی</label>
                <p class="text-xs text-gray-400 mb-3">فرمت مورد نظر برای فایل نهایی را انتخاب کنید.</p>
                <div class="flex flex-col sm:flex-row gap-4 p-3 bg-gray-900 rounded-lg">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="output-format" value="ass" checked class="w-4 h-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-600 ring-offset-gray-800 focus:ring-2">
                        ASS (فرمت پیشرفته - فونت و استایل)
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="output-format" value="srt" class="w-4 h-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-600 ring-offset-gray-800 focus:ring-2">
                        SRT (فرمت ساده - متن خالی)
                    </label>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mt-6">
                <button id="startTranslation" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    شروع ترجمه
                </button>
                <button id="stopTranslation" class="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition duration-300" style="display: none;">
                    ⛔ توقف عملیات
                </button>
                <button id="downloadFiles" class="flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    دانلود فایل(ها)
                </button>
            </div>

            <div class="mt-6" id="overallProgressSection" style="display: none;">
                <label class="block mb-2 text-sm font-medium text-gray-300 break-words leading-relaxed" id="overallProgressLabel">پیشرفت کلی</label>
                <!-- [!!!] FIX: added overflow-hidden to rounded-full container for aesthetic safety [!!!] -->
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="overallProgressBar" class="bg-blue-500 h-4 rounded-full progress-bar-inner" style="width: 0%"></div>
                </div>
                <pre id="liveOutput" style="display: none; direction: rtl; text-align: right;"></pre>
                
                <p id="translationStatusMessage" class="status-message hidden"></p>
            </div>
            
            <div id="statusLog" class="mt-4 p-4 bg-gray-900 rounded-lg max-h-48 overflow-y-auto text-sm text-gray-300" style="display: none;">
                </div>
        </div>
        
    </div> <footer class="text-center mt-12 pb-8">
        <p class="text-gray-400 text-sm mb-2">
            توسعه دهنده : Abolfazl_ASDBV
        </p>
        <div class="flex justify-center gap-4">
            <a href="https://t.me/anime_sub_Persian" target="_blank" rel="noopener noreferrer" title="Telegram"
               class="text-gray-400 hover:text-blue-400 transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" role="img" aria-label="Telegram icon">
                    <title>تلگرام</title>
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-1.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/anime_wd20?igsh=dTA1dmNsYjhzcGx1" target="_blank" rel="noopener noreferrer" title="Instagram"
               class="text-gray-400 hover:text-purple-400 transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" role="img" aria-label="Instagram icon">
                    <title>اینستاگرام</title>
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
        </div>
    </footer>
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" style="display: none; z-index: 50;">
        <div class="bg-gray-800 rounded-lg shadow-xl max-w-lg w-full p-6">
            <h3 class="text-2xl font-bold text-red-500 mb-4">خطا در عملیات</h3>
            <div id="errorMessageContainer" class="text-gray-300 mb-6 text-right max-h-96 overflow-y-auto">
                </div>
            <button id="closeModal" class="w-full px-6 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition duration-300">
                بستن
            </button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
