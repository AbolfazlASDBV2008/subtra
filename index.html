<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مترجم زیرنویس انیمه</title>
    
    <link rel="icon" type="image/jpeg" href="image-logo.jpg">
    <link rel="apple-touch-icon" href="image-logo.jpg">
    
    <meta name="theme-color" content="#3b82f6">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    
    <style>
        /* اعمال فونت وزیرمتن به کل صفحه */
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        input[type="file"] { display: none; }
        .file-upload-label { cursor: pointer; transition: all 0.3s ease; }
        #dropZone { border-style: dashed; transition: all 0.3s ease; }
        #dropZone.drag-over { background-color: #374151; border-color: #60a5fa; }
        .progress-bar-inner { transition: width 0.4s ease; }
        
        details summary { list-style: none; cursor: pointer; }
        details summary::-webkit-details-marker { display: none; }
        details summary::before { content: '◀'; display: inline-block; transition: transform 0.2s; margin-left: 0.5rem; }
        details[open] summary::before { transform: rotate(-90deg); }
        
        .safety-settings-content {
            margin-top: 1rem;
            padding: 1rem 1.5rem;
            border: 1px solid #4b5563; /* gray-600 */
            border-radius: 0.5rem;
            background-color: #1f2937; /* gray-800 */
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .proxy-setting-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1rem;
            padding: 0.5rem;
            border: 1px dashed #4b5563; /* gray-600 */
            border-radius: 0.5rem;
        }

        .status-message {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: bold;
            text-align: center;
        }
        .status-complete { background-color: #166534; border: 1px solid #22c55e; color: #dcfce7; } /* green */
        .status-incomplete { background-color: #854d0e; border: 1px solid #f59e0b; color: #fefce8; } /* amber */
        .status-aborted { background-color: #991b1b; border: 1px solid #ef4444; color: #fee2e2; } /* red */

        #liveOutput {
            background-color: #111827; /* gray-900 */
            border: 1px solid #4b5563; /* gray-600 */
            border-radius: 0.5rem;
            padding: 1rem;
            height: 200px; /* ارتفاع ثابت */
            max-height: 40vh; /* حداکثر ارتفاع */
            overflow-y: auto; /* اسکرول عمودی */
            white-space: pre-wrap; /* شکستن خطوط */
            word-break: break-word; /* شکستن کلمات */
            font-size: 0.9rem; /* کمی کوچکتر */
            line-height: 1.7;
            color: #d1d5db; /* gray-300 */
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-4 md:p-8 min-h-screen">

    <div class="max-w-5xl mx-auto">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                مترجم زیرنویس انیمه
            </h1>
            <p class="text-gray-400 mt-2">
                فایل‌های VTT, SRT, یا ASS خود را به فارسی روان ترجمه کنید و با فرمت ASS تحویل بگیرید.
            </p>
        </header>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">تنظیمات</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <div class="mb-4">
                        <label for="apiKey" class="block mb-2 text-sm font-medium text-gray-300">
                            کلید API گوگل (Gemini)
                        </label>
                        <input type="password" id="apiKey" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500" placeholder="کلید API خود را اینجا وارد کنید...">
                    </div>

                    <div class="mb-4">
                        <label for="modelSelect" class="block mb-2 text-sm font-medium text-gray-300">انتخاب مدل هوش مصنوعی</label>
                        <select id="modelSelect" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500">
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro (جدیدترین و دقیق‌ترین)</option>
                            <option value="gemini-2.5-flash-preview-09-2025">Gemini 2.5 Flash (سریع‌ترین)</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="fpsInput" class="block mb-2 text-sm font-medium text-gray-300">
                            نرخ فریم (FPS)
                        </label>
                        <input type="number" id="fpsInput" step="0.001" value="23.976" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500" style="direction: ltr; text-align: left;">
                        <p class="text-xs text-gray-400 mt-1">مقدار پیش‌فرض 23.976 است. اگر زیرنویس هماهنگ نبود، این مقدار را (مثلاً به 25) تغییر دهید.</p>
                    </div>

                    <div class="proxy-setting-container">
                        <input type="checkbox" id="proxy-toggle" class="w-5 h-5 cursor-pointer">
                        <label for="proxy-toggle" class="font-medium text-gray-300 cursor-pointer">
                            استفاده از پراکسی (برای دور زدن تحریم)
                        </label>
                    </div>
                </div>

                <div>
                    <details class="safety-settings-details" role="region">
                        <summary class="font-medium text-gray-300" aria-expanded="false" aria-controls="safety-settings-content">
                            تنظیمات ایمنی (Safety Settings)
                        </summary>
                        <div class="safety-settings-content" id="safety-settings-content">
                            <p class="text-xs text-gray-400">فعال کردن این گزینه‌ها فیلترهای محتوای Gemini را غیرفعال می‌کند. (ممکن است زمان ترجمه را افزایش دهد)</p>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="safety-harassment-toggle" class="w-4 h-4">
                                آزار و اذیت (Harassment)
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="safety-hate-speech-toggle" class="w-4 h-4">
                                سخنان نفرت‌پراکن (Hate Speech)
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="safety-sexually-explicit-toggle" class="w-4 h-4">
                                محتوای جنسی (Sexually Explicit)
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="safety-dangerous-content-toggle" class="w-4 h-4">
                                محتوای خطرناک (Dangerous)
                            </label>
                        </div>
                    </details>
                </div>
            </div>


            <div class="mt-6">
                <label for="systemPrompt" class="block mb-2 text-sm font-medium text-gray-300">پرامپت سیستم (System Prompt)</label>
                <textarea id="systemPrompt" rows="8" class="w-full p-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-blue-500 focus:border-blue-500" style="text-align: right; direction: rtl;"></textarea>
            </div>
            
            <div class="flex items-center gap-4 mt-4">
                <button id="saveSettings" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-semibold transition duration-300 shadow-md">
                    ذخیره تنظیمات
                </button>
                <button id="resetSettings" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-sm font-semibold transition duration-300 shadow-md">
                    بازگردانی به پیش‌فرض
                </button>
                <span id="settingsSaved" class="text-green-400 hidden">تنظیمات ذخیره شد!</span>
                <span id="settingsReset" class="text-amber-400 hidden">تنظیمات به پیش‌فرض بازگردانی شد!</span>
            </div>
            </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">۱. انتخاب فایل‌ها</h2>
            <div id="dropZone" class="border-2 border-gray-600 rounded-lg p-10 text-center text-gray-400">
                <p class="mb-4">فایل‌های زیرنویس خود را اینجا بکشید و رها کنید</p>
                <p class="mb-4 text-sm">(فرمت‌های .vtt, .srt, .ass)</p>
                <label for="fileInput" class="file-upload-label px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium">
                    یا برای انتخاب فایل کلیک کنید
                </label>
                <input type="file" id="fileInput" multiple accept=".vtt,.srt,.ass">
            </div>
            <div id="fileList" class="mt-6 space-y-3">
                </div>
            <button id="clearFileList" class="mt-4 w-full md:w-auto px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-xs font-medium transition duration-300 disabled:opacity-50" style="display: none;">
                پاک کردن لیست فایل‌ها
            </button>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">۲. شروع عملیات</h2>
            
            <div id="outputFormatSelector" class="mt-6" style="display: none;">
                <label class="block mb-2 text-sm font-medium text-gray-300">فرمت فایل خروجی (برای فایل .ass)</label>
                <p class="text-xs text-gray-400 mb-3">شما یک فایل ASS آپلود کرده‌اید. می‌توانید انتخاب کنید که استایل‌های اصلی حفظ شوند.</p>
                <div class="flex flex-col sm:flex-row gap-4 p-3 bg-gray-900 rounded-lg">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="output-format" value="ass" checked class="w-4 h-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-600 ring-offset-gray-800 focus:ring-2">
                        ASS (حفظ استایل‌ها - حرفه‌ای و زیبا)
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="output-format" value="srt" class="w-4 h-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-600 ring-offset-gray-800 focus:ring-2">
                        SRT (تبدیل به فرمت ساده - سریع و سبک)
                    </label>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mt-6">
                <button id="startTranslation" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    شروع ترجمه
                </button>
                <button id="stopTranslation" class="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition duration-300" style="display: none;">
                    ⛔ توقف عملیات
                </button>
                <button id="downloadFiles" class="flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    دانلود فایل(ها)
                </button>
            </div>

            <div class="mt-6" id="overallProgressSection" style="display: none;">
                <label class="block mb-2 text-sm font-medium text-gray-300 break-words leading-relaxed" id="overallProgressLabel">پیشرفت کلی</label>
                <div class="w-full bg-gray-700 rounded-full h-4">
                    <div id="overallProgressBar" class="bg-blue-500 h-4 rounded-full progress-bar-inner" style="width: 0%"></div>
                </div>
                <pre id="liveOutput" style="display: none; direction: rtl; text-align: right;"></pre>
                
                <p id="translationStatusMessage" class="status-message hidden"></p>
            </div>
            
            <div id="statusLog" class="mt-4 p-4 bg-gray-900 rounded-lg max-h-48 overflow-y-auto text-sm text-gray-300" style="display: none;">
                </div>
        </div>
        
    </div> <footer class="text-center mt-12 pb-8">
        <p class="text-gray-400 text-sm mb-2">
            توسعه دهنده : Abolfazl_ASDBV
        </p>
        <div class="flex justify-center gap-4">
            <a href="https://t.me/anime_sub_Persian" target="_blank" rel="noopener noreferrer" title="Telegram"
               class="text-gray-400 hover:text-blue-400 transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" role="img" aria-label="Telegram icon">
                    <title>تلگرام</title>
                    <path d="M11.999 0C5.372 0 0 5.373 0 12s5.372 12 11.999 12C18.626 24 24 18.627 24 12S18.626 0 11.999 0zM18.26 8.13l-2.73 12.04c-.15.66-.54 1.25-1.1 1.25-.3 0-.58-.12-.82-.36l-3.37-3.11-1.63 1.57c-.18.17-.4.29-.63.29-.3 0-.58-.12-.8-.34l-.45-.43c-.4-.38-.63-1.12-.2-1.6l2.9-4.3 6.03-5.52c.26-.24.06-.39-.22-.25l-7.3 4.54-3.5-1.09c-.6-.18-.9-.45-.9-.94 0-.4.2-.68.6-.85l14.28-5.57c.5-.2 1.02.1 1.2.63z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/anime_wd20?igsh=dTA1dmNsYjhzcGx1" target="_blank" rel="noopener noreferrer" title="Instagram"
               class="text-gray-400 hover:text-purple-400 transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" role="img" aria-label="Instagram icon">
                    <title>اینستاگرام</title>
                    <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.784.297-1.459.717-2.126 1.384S.927 3.356.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.297.784.717 1.459 1.384 2.126.667.666 1.342 1.086 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.784-.297 1.459-.718 2.126-1.384.666-.667 1.086-1.342 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.277.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.148-.558-2.913-.297-.784-.718-1.459-1.384-2.126C20.644.927 19.969.507 19.185.21c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.163c3.203 0 3.585.012 4.85.07 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.265.07 1.646.07 4.85s-.012 3.585-.07 4.85c-.055 1.17-.249 1.805-.413 2.227-.217.562-.477.96-.896 1.382.42-.419-.819.679-1.381.896-.422.164-1.057.36-2.227.413-1.265.057-1.646.07-4.85.07s-3.585-.012-4.85-.07c-1.17-.055-1.805-.249-2.227-.413-.562-.217-.96-.477-1.382-.896-.419-.42-.679-.819-.896-1.381-.164.422-.36-1.057-.413-2.227-.057-1.265-.07-1.646-.07-4.85s.012-3.585.07-4.85c.055 1.17.249 1.805.413 2.227.217.562.477.96.896-1.382.42-.419.819.679 1.381-.896.422.164 1.057.36 2.227.413 1.265.057 1.646.07 4.85.07zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z"/>
                </svg>
            </a>
        </div>
    </footer>
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" style="display: none; z-index: 50;">
        <div class="bg-gray-800 rounded-lg shadow-xl max-w-lg w-full p-6">
            <h3 class="text-2xl font-bold text-red-500 mb-4">خطا در عملیات</h3>
            <div id="errorMessageContainer" class="text-gray-300 mb-6 text-right max-h-96 overflow-y-auto">
                </div>
            <button id="closeModal" class="w-full px-6 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition duration-300">
                بستن
            </button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
